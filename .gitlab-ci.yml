stages:
  - sync

# Sync from GitLab to GitHub when pushing to GitLab
sync-to-github:
  stage: sync
  image: alpine/git:latest
  only:
    - main
    - develop
    - /^feature\/.*/
    - /^hotfix\/.*/
  script:
    - git remote add github https://${GITHUB_TOKEN}@github.com/Intowork-Search/IntoWork-Dashboard.git || true
    - git push github ${CI_COMMIT_REF_NAME} --force-with-lease
    - git push github --tags --force-with-lease
  tags:
    - docker
  allow_failure: false
  when: on_success
