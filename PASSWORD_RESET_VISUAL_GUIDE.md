# Guide Visuel : SystÃ¨me de RÃ©initialisation de Mot de Passe

## Architecture Visuelle

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SYSTÃˆME DE RÃ‰INITIALISATION                       â”‚
â”‚                         DE MOT DE PASSE                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   1. USER ACTION    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Page: /auth/forgot-password                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ğŸ“§ Adresse e-mail: ___________________________  [Envoyer] â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â”‚ POST /api/auth/forgot-password
                                 â”‚ { email: "user@example.com" }
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BACKEND: forgot_password()                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  1. db.query(User).filter(email == request.email)         â”‚  â”‚
â”‚  â”‚  2. secrets.token_urlsafe(32) â†’ 43 chars token            â”‚  â”‚
â”‚  â”‚  3. PasswordResetToken(token, expires_at=now+24h)         â”‚  â”‚
â”‚  â”‚  4. db.add(reset_token) & db.commit()                     â”‚  â”‚
â”‚  â”‚  5. email_service.send_password_reset_email()             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â”‚ Resend API
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SERVICE EMAIL: Resend                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Template HTML Professionnel                               â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  ğŸŒŸ INTOWORK                                         â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  Bonjour {user.first_name},                          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                        â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  Demande de rÃ©initialisation reÃ§ue.                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                        â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  ğŸ”‘ RÃ©initialiser mon mot de passe           â”‚    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                        â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  Lien: /reset-password?token=xxxxx                   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â° Expire dans 24h                                   â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â”‚ Email reÃ§u
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Page: /auth/reset-password?token=xxxxxxxxxx                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ğŸ”’ Nouveau mot de passe: _______________ [ğŸ‘]           â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  Force: â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘ Moyen                                    â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  ğŸ”’ Confirmer: _______________ [ğŸ‘]                       â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  âœ“ Les mots de passe correspondent                        â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  [RÃ©initialiser le mot de passe]                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â”‚ POST /api/auth/reset-password
                                 â”‚ { token: "xxx", new_password: "xxx" }
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BACKEND: reset_password()                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  1. db.query(PasswordResetToken).filter(token)            â”‚  â”‚
â”‚  â”‚  2. if used_at is not None â†’ ERROR                        â”‚  â”‚
â”‚  â”‚  3. if expires_at < now â†’ ERROR                           â”‚  â”‚
â”‚  â”‚  4. if len(password) < 8 â†’ ERROR                          â”‚  â”‚
â”‚  â”‚  5. user.password_hash = bcrypt.hash(new_password)        â”‚  â”‚
â”‚  â”‚  6. reset_token.used_at = now                             â”‚  â”‚
â”‚  â”‚  7. db.commit()                                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â”‚ Success
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SUCCESS STATE                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  âœ… Mot de passe rÃ©initialisÃ© !                           â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  Vous pouvez maintenant vous connecter.                   â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  Redirection dans 3 secondes...                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â”‚ Auto redirect
                                 â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚  /auth/signin   â”‚
                        â”‚                 â”‚
                        â”‚  Login OK âœ“     â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Base de DonnÃ©es : Table `password_reset_tokens`

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  password_reset_tokens                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Column   â”‚ Type            â”‚ Description                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id       â”‚ SERIAL PK       â”‚ Identifiant unique              â”‚
â”‚ user_id  â”‚ INT FK â†’ users  â”‚ RÃ©fÃ©rence vers l'utilisateur    â”‚
â”‚ token    â”‚ VARCHAR UNIQUE  â”‚ Token sÃ©curisÃ© (43 chars)       â”‚
â”‚ expires  â”‚ TIMESTAMP       â”‚ Date d'expiration (created+24h) â”‚
â”‚ used_at  â”‚ TIMESTAMP?      â”‚ Date d'utilisation (NULL=actif) â”‚
â”‚ created  â”‚ TIMESTAMP       â”‚ Date de crÃ©ation                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Indexes:
  - ix_password_reset_tokens_user_id (user_id)
  - ix_password_reset_tokens_token (token) UNIQUE

Lifecycle d'un token:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   CREATED   â”‚ â”€â”€> â”‚  ACTIVE  â”‚ â”€â”€> â”‚   USED   â”‚
â”‚ used_at=NULLâ”‚     â”‚ <24h old â”‚     â”‚ used_at  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ EXPIRED  â”‚
                    â”‚  >24h    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## SÃ©curitÃ© : Flux de validation

```
POST /auth/forgot-password { email }
â”‚
â”œâ”€ Email existe ?
â”‚  â”œâ”€ OUI
â”‚  â”‚  â”œâ”€ Invalider anciens tokens (used_at=now)
â”‚  â”‚  â”œâ”€ GÃ©nÃ©rer nouveau token (secrets.token_urlsafe(32))
â”‚  â”‚  â”œâ”€ Stocker en DB (expires_at = now + 24h)
â”‚  â”‚  â””â”€ Envoyer email
â”‚  â”‚
â”‚  â””â”€ NON
â”‚     â””â”€ Ne rien faire (sÃ©curitÃ©: ne pas rÃ©vÃ©ler)
â”‚
â””â”€ Toujours retourner: "Si email existe, vous recevrez instructions"


POST /auth/reset-password { token, new_password }
â”‚
â”œâ”€ Token existe en DB ?
â”‚  â”œâ”€ NON â†’ ERROR 400 "Invalid token"
â”‚  â”‚
â”‚  â””â”€ OUI
â”‚     â”‚
â”‚     â”œâ”€ Token dÃ©jÃ  utilisÃ© (used_at != NULL) ?
â”‚     â”‚  â””â”€ OUI â†’ ERROR 400 "Already used"
â”‚     â”‚
â”‚     â”œâ”€ Token expirÃ© (expires_at < now) ?
â”‚     â”‚  â””â”€ OUI â†’ ERROR 400 "Expired"
â”‚     â”‚
â”‚     â”œâ”€ Password valide (len >= 8) ?
â”‚     â”‚  â””â”€ NON â†’ ERROR 400 "Too short"
â”‚     â”‚
â”‚     â””â”€ TOUT OK
â”‚        â”œâ”€ Hash password (bcrypt)
â”‚        â”œâ”€ Update user.password_hash
â”‚        â”œâ”€ Marquer token utilisÃ© (used_at=now)
â”‚        â”œâ”€ Invalider autres tokens de l'user
â”‚        â””â”€ SUCCESS 200
```

---

## Indicateur de Force du Mot de Passe

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Force du mot de passe                              Faible  â”‚
â”‚  â–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
CritÃ¨res: length < 8 chars

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Force du mot de passe                              Moyen   â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
CritÃ¨res: 8+ chars, lowercase + uppercase, numbers

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Force du mot de passe                              Fort    â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
CritÃ¨res: 12+ chars, lowercase + uppercase, numbers, symbols

Validation:
âœ“ Au moins 8 caractÃ¨res (obligatoire)
âœ“ Lettres majuscules et minuscules (recommandÃ©)
âœ“ Au moins un chiffre (recommandÃ©)
âœ“ Au moins un caractÃ¨re spÃ©cial (recommandÃ©)
```

---

## Stack Technique

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FRONTEND                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Next.js 14 (App Router)                                 â”‚  â”‚
â”‚  â”‚  - /auth/forgot-password (existante)                     â”‚  â”‚
â”‚  â”‚  - /auth/reset-password?token=xxx (nouvelle)             â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  TypeScript + Tailwind CSS                               â”‚  â”‚
â”‚  â”‚  - Formulaires avec validation                           â”‚  â”‚
â”‚  â”‚  - Password strength indicator                           â”‚  â”‚
â”‚  â”‚  - Toast notifications (react-hot-toast)                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â”‚ HTTP (axios)
                                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         BACKEND                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  FastAPI 0.104+ (Python 3.10+)                           â”‚  â”‚
â”‚  â”‚  - POST /api/auth/forgot-password                        â”‚  â”‚
â”‚  â”‚  - POST /api/auth/reset-password                         â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  SQLAlchemy 2.0+ (ORM)                                   â”‚  â”‚
â”‚  â”‚  - Model: PasswordResetToken                             â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  Security: bcrypt + secrets                              â”‚  â”‚
â”‚  â”‚  - Token: secrets.token_urlsafe(32)                      â”‚  â”‚
â”‚  â”‚  - Password: bcrypt.hashpw()                             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚            â”‚            â”‚
                    â–¼            â–¼            â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   PostgreSQL    â”‚  â”‚Resendâ”‚  â”‚   Logs     â”‚
        â”‚   port 5433     â”‚  â”‚ API  â”‚  â”‚  (logger)  â”‚
        â”‚                 â”‚  â”‚      â”‚  â”‚            â”‚
        â”‚ password_reset_ â”‚  â”‚Email â”‚  â”‚ INFO/ERROR â”‚
        â”‚    tokens       â”‚  â”‚HTML  â”‚  â”‚            â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Tests : Couverture ComplÃ¨te

```
test_password_reset.py (15+ tests)
â”‚
â”œâ”€ TestForgotPassword (4 tests)
â”‚  â”œâ”€ âœ… test_forgot_password_with_valid_email
â”‚  â”‚     VÃ©rifie: token crÃ©Ã©, expires_at correct, token unique
â”‚  â”‚
â”‚  â”œâ”€ âœ… test_forgot_password_with_invalid_email
â”‚  â”‚     VÃ©rifie: retourne succÃ¨s, aucun token crÃ©Ã© (sÃ©curitÃ©)
â”‚  â”‚
â”‚  â”œâ”€ âœ… test_forgot_password_invalidates_old_tokens
â”‚  â”‚     VÃ©rifie: anciens tokens marquÃ©s used_at
â”‚  â”‚
â”‚  â””â”€ âœ… test_forgot_password_with_invalid_email_format
â”‚        VÃ©rifie: erreur 422 pour format invalide
â”‚
â”œâ”€ TestResetPassword (6 tests)
â”‚  â”œâ”€ âœ… test_reset_password_with_valid_token
â”‚  â”‚     VÃ©rifie: password changÃ©, token marquÃ© utilisÃ©
â”‚  â”‚
â”‚  â”œâ”€ âœ… test_reset_password_with_expired_token
â”‚  â”‚     VÃ©rifie: erreur 400 "expired"
â”‚  â”‚
â”‚  â”œâ”€ âœ… test_reset_password_with_used_token
â”‚  â”‚     VÃ©rifie: erreur 400 "already used"
â”‚  â”‚
â”‚  â”œâ”€ âœ… test_reset_password_with_invalid_token
â”‚  â”‚     VÃ©rifie: erreur 400 "invalid"
â”‚  â”‚
â”‚  â”œâ”€ âœ… test_reset_password_with_short_password
â”‚  â”‚     VÃ©rifie: erreur 400 "8 characters"
â”‚  â”‚
â”‚  â””â”€ âœ… test_reset_password_invalidates_other_tokens
â”‚        VÃ©rifie: autres tokens de l'user invalidÃ©s
â”‚
â””â”€ TestPasswordResetIntegration (1 test)
   â””â”€ âœ… test_complete_password_reset_flow
         VÃ©rifie: flux complet end-to-end
         forgot â†’ email â†’ reset â†’ login

Commande:
  pytest test_password_reset.py -v
```

---

## Documentation : Structure

```
ğŸ“š DOCUMENTATION
â”‚
â”œâ”€ ğŸš€ QUICK_START_PASSWORD_RESET.md (3.3 KB)
â”‚  â”œâ”€ Configuration en 5 minutes
â”‚  â”œâ”€ Installation dÃ©pendances
â”‚  â”œâ”€ Configuration Resend
â”‚  â”œâ”€ Migration DB
â”‚  â””â”€ Test du systÃ¨me
â”‚
â”œâ”€ ğŸ“– PASSWORD_RESET_SETUP.md (11 KB)
â”‚  â”œâ”€ Vue d'ensemble & architecture
â”‚  â”œâ”€ Configuration backend dÃ©taillÃ©e
â”‚  â”œâ”€ Configuration frontend
â”‚  â”œâ”€ Utilisation (UI + API)
â”‚  â”œâ”€ Template email
â”‚  â”œâ”€ Maintenance & monitoring
â”‚  â””â”€ Troubleshooting complet
â”‚
â”œâ”€ ğŸ—ï¸ PASSWORD_RESET_IMPLEMENTATION.md (11 KB)
â”‚  â”œâ”€ RÃ©sumÃ© implÃ©mentation
â”‚  â”œâ”€ Fichiers crÃ©Ã©s/modifiÃ©s
â”‚  â”œâ”€ Architecture technique
â”‚  â”œâ”€ API endpoints dÃ©taillÃ©s
â”‚  â”œâ”€ Base de donnÃ©es
â”‚  â””â”€ Support & maintenance
â”‚
â””â”€ ğŸ“Š PASSWORD_RESET_SUMMARY.md (14 KB)
   â”œâ”€ Statut & livrables
   â”œâ”€ FonctionnalitÃ©s clÃ©s
   â”œâ”€ API endpoints avec exemples
   â”œâ”€ Pages frontend
   â”œâ”€ Template email
   â”œâ”€ Tests
   â”œâ”€ Troubleshooting
   â”œâ”€ Maintenance
   â””â”€ Checklist production
```

---

## DÃ©ploiement : Checklist Visuelle

```
AVANT LE DÃ‰PLOIEMENT

â–¡ Backend
  â–¡ RESEND_API_KEY configurÃ© (production)
  â–¡ FROM_EMAIL avec domaine vÃ©rifiÃ©
  â–¡ FRONTEND_URL avec URL production
  â–¡ Migration appliquÃ©e (alembic upgrade head)
  â–¡ Tests passent (pytest test_password_reset.py)
  â–¡ Logs configurÃ©s

â–¡ Frontend
  â–¡ NEXT_PUBLIC_API_URL pointe vers backend prod
  â–¡ Build rÃ©ussi (npm run build)
  â–¡ Pages accessibles (/auth/forgot-password, /reset-password)

â–¡ Email Service
  â–¡ Compte Resend crÃ©Ã©
  â–¡ Domaine vÃ©rifiÃ© sur Resend
  â–¡ ClÃ© API gÃ©nÃ©rÃ©e (production)
  â–¡ Email test envoyÃ© et reÃ§u

â–¡ SÃ©curitÃ©
  â–¡ HTTPS activÃ© (obligatoire)
  â–¡ CORS configurÃ© correctement
  â–¡ Variables d'env sÃ©curisÃ©es
  â–¡ Logs ne contiennent pas de secrets

â–¡ Monitoring
  â–¡ Job de nettoyage tokens expirÃ©s configurÃ©
  â–¡ Alertes sur Ã©checs d'envoi email
  â–¡ MÃ©triques de reset password trackÃ©es

APRÃˆS LE DÃ‰PLOIEMENT

â–¡ Test flux complet en production
â–¡ VÃ©rifier rÃ©ception d'emails
â–¡ VÃ©rifier logs backend/frontend
â–¡ Documenter pour l'Ã©quipe
â–¡ Former le support
```

---

## Support : DÃ©marche de Debug

```
PROBLÃˆME: Email non reÃ§u

1. VÃ©rifier configuration
   â–¡ RESEND_API_KEY dÃ©fini ? â†’ backend/.env
   â–¡ email_service.enabled == True ?

2. VÃ©rifier logs backend
   â–¡ "Password reset email sent successfully" ?
   â–¡ "Failed to send password reset email" ?

3. VÃ©rifier Resend dashboard
   â–¡ Email dans logs d'envoi ?
   â–¡ Statut: delivered / bounced ?

4. VÃ©rifier boÃ®te mail
   â–¡ Dossier spam/promotions ?
   â–¡ Filtres email actifs ?


PROBLÃˆME: Token invalide

1. VÃ©rifier en base de donnÃ©es
   SELECT * FROM password_reset_tokens
   WHERE user_id = XXX
   ORDER BY created_at DESC;

   â–¡ Token existe ?
   â–¡ used_at IS NULL ?
   â–¡ expires_at > NOW() ?

2. VÃ©rifier URL
   â–¡ Token complet dans URL ?
   â–¡ Pas de troncature ?

3. VÃ©rifier timing
   â–¡ < 24h depuis demande ?


PROBLÃˆME: Page ne charge pas

1. Backend dÃ©marrÃ© ?
   curl http://localhost:8001/api/ping

2. Frontend dÃ©marrÃ© ?
   curl http://localhost:3000

3. CORS configurÃ© ?
   VÃ©rifier headers dans Network tab

4. Variables d'env ?
   NEXT_PUBLIC_API_URL correct ?
```

---

**Version**: 1.0.0
**Date**: 2025-12-26
**Status**: Production Ready
